<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dealing with iLO firmware updates &mdash; python-hpilo 4.4.3 documentation</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Unauthenticated iLO and Chassis OA data" href="xmldata.html" />
    <link rel="prev" title="SNMP settings" href="snmp.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            python-hpilo
              <img src="_static/python-hpilo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                4.4.3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installing python-hpilo</a></li>
<li class="toctree-l1"><a class="reference internal" href="python.html">Access from Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="shell.html">Access from the shell</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="info.html">General server and iLO information</a></li>
<li class="toctree-l1"><a class="reference internal" href="networksettings.html">Network settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">iLO licensing</a></li>
<li class="toctree-l1"><a class="reference internal" href="authentication.html">Authentication settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="security.html">Security and SSL settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="health.html">Server health</a></li>
<li class="toctree-l1"><a class="reference internal" href="power.html">Power manipulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="boot.html">Boot settings and rebooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="media.html">Virtual media</a></li>
<li class="toctree-l1"><a class="reference internal" href="input.html">Keyboard and mouse settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="snmp.html">SNMP settings</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Dealing with iLO firmware updates</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#from-the-cli">From the CLI</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-the-api">Using the API</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-a-local-firmware-mirror">Using a local firmware mirror</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="xmldata.html">Unauthenticated iLO and Chassis OA data</a></li>
<li class="toctree-l1"><a class="reference internal" href="log.html">iLO event log</a></li>
<li class="toctree-l1"><a class="reference internal" href="federation.html">Federation groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="ahs.html">Active Health System and Insight Remote Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="profile.html">Deployment profiles</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ca.html">Managing SSL certificates</a></li>
<li class="toctree-l1"><a class="reference internal" href="elasticsearch.html">iLO information search</a></li>
<li class="toctree-l1"><a class="reference internal" href="autofirmware.html">Automated firmware updates</a></li>
<li class="toctree-l1"><a class="reference internal" href="puppet.html">Managing iLO’s with puppet</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Common issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">python-hpilo</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Dealing with iLO firmware updates</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="dealing-with-ilo-firmware-updates">
<h1>Dealing with iLO firmware updates<a class="headerlink" href="#dealing-with-ilo-firmware-updates" title="Permalink to this headline">¶</a></h1>
<p>One of the key features of python_hpilo is that it makes iLO firmware updates
painless. It can download the firmware for you, or you can feed it the .bin,
.scexe or .fwpkg files HP ships.</p>
<p>Note that the newest versions of the firmware, as of August 2020, are shipped
in a new format and you will need to use python-hpilo 4.4 or newer to extract
and use them. If you cannot upgrade, you can manually extract the .bin file
from the .fwpkg file (just open it with anything that can open zip files) and
pass the .bin file to python-hpilo.</p>
<div class="section" id="from-the-cli">
<h2>From the CLI<a class="headerlink" href="#from-the-cli" title="Permalink to this headline">¶</a></h2>
<p>The method to call is <code class="xref py py-func docutils literal notranslate"><span class="pre">update_rib_firmware()</span></code>. To tell it which firmware
version to install, you can specify a version or a filename. To install the
latest version, you can use <code class="xref py py-data docutils literal notranslate"><span class="pre">latest</span></code> as version. Information about
available version numbers can be found in <a class="reference external" href="https://seveas.github.io/python-hpilo/firmware.conf">firmware.conf</a>.</p>
<p>Some example commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hpilo_cli</span> <span class="n">example</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">int</span><span class="o">.</span><span class="n">kaarsemaker</span><span class="o">.</span><span class="n">net</span> <span class="n">update_rib_firmware</span> <span class="n">version</span><span class="o">=</span><span class="mf">1.28</span>
<span class="n">hpilo_cli</span> <span class="n">example</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">int</span><span class="o">.</span><span class="n">kaarsemaker</span><span class="o">.</span><span class="n">net</span> <span class="n">update_rib_firmware</span> <span class="n">version</span><span class="o">=</span><span class="n">latest</span>
<span class="n">hpilo_cli</span> <span class="n">example</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">int</span><span class="o">.</span><span class="n">kaarsemaker</span><span class="o">.</span><span class="n">net</span> <span class="n">update_rib_firmware</span> <span class="n">filename</span><span class="o">=</span><span class="n">CP007684</span><span class="o">.</span><span class="n">scexe</span>
<span class="n">hpilo_cli</span> <span class="n">example</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">int</span><span class="o">.</span><span class="n">kaarsemaker</span><span class="o">.</span><span class="n">net</span> <span class="n">update_rib_firmware</span> <span class="n">filename</span><span class="o">=</span><span class="n">ilo2_225</span><span class="o">.</span><span class="n">bin</span>
</pre></div>
</div>
<p>If you just want to download the firmware, you can make <code class="xref py py-data docutils literal notranslate"><span class="pre">hpilo_cli</span></code> do
that too:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hpilo_cli</span> <span class="n">download_rib_firmware</span> <span class="nb">all</span>        <span class="c1"># Download latest firmware for all iLO types</span>
<span class="n">hpilo_cli</span> <span class="n">download_rib_firmware</span> <span class="n">ilo4</span>       <span class="c1"># Download latest iLO 4 firmware</span>
<span class="n">hpilo_cli</span> <span class="n">download_rib_firmware</span> <span class="n">ilo4</span> <span class="mf">1.50</span>  <span class="c1"># Download a specific firmware version</span>
<span class="n">hpilo_cli</span> <span class="n">download_rib_firmware</span> <span class="n">ilo4</span> <span class="nb">all</span>   <span class="c1"># Download all firmware versions for iLO 4</span>
<span class="n">hpilo_cli</span> <span class="n">download_rib_firmware</span> <span class="nb">all</span> <span class="nb">all</span>    <span class="c1"># Download all firmware versions for all iLO types</span>
</pre></div>
</div>
</div>
<div class="section" id="using-the-api">
<h2>Using the API<a class="headerlink" href="#using-the-api" title="Permalink to this headline">¶</a></h2>
<p>As the CLI is merely a thin wrapper around the API, using the API is as expected:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ilo</span> <span class="o">=</span> <span class="n">hpilo</span><span class="o">.</span><span class="n">Ilo</span><span class="p">(</span><span class="n">hostname</span><span class="p">,</span> <span class="n">login</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
<span class="n">ilo</span><span class="o">.</span><span class="n">update_rib_firmware</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="s1">&#39;latest&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>But since firmware updates may take a while, the iLO can provide progress
messages, which your code may in turn show to your users. To receive these
progress message, pass a callable to the <code class="xref py py-func docutils literal notranslate"><span class="pre">update_rib_firmware()</span></code> function.
It will be called with single-line messages about the progress of the firmware
download, upload and flash processes. This example shows them to the user,
constantly overwriting the previous message:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">print_progress</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r\033</span><span class="s1">[K&#39;</span> <span class="o">+</span> <span class="n">text</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

<span class="n">ilo</span> <span class="o">=</span> <span class="n">hpilo</span><span class="o">.</span><span class="n">Ilo</span><span class="p">(</span><span class="n">hostname</span><span class="p">,</span> <span class="n">login</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
<span class="n">ilo</span><span class="o">.</span><span class="n">update_rib_firmware</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="s1">&#39;latest&#39;</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">print_progress</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Of course the firmware downloader can be used from the API as well:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">hpilo_fw</span>
<span class="n">hpilo_fw</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;ilo4&#39;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/var/cache/ilo_fw/&#39;</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">print_progress</span><span class="p">)</span>
<span class="n">hpilo_fw</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;ilo3 1.28&#39;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/var/cache/ilo_fw&#39;</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">print_progress</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="using-a-local-firmware-mirror">
<h2>Using a local firmware mirror<a class="headerlink" href="#using-a-local-firmware-mirror" title="Permalink to this headline">¶</a></h2>
<p>The firmware download functions connect to the internet to download firmware.
While they can be made to use a proxy, using the standard <code class="xref py py-data docutils literal notranslate"><span class="pre">https_proxy</span></code>
and <code class="xref py py-data docutils literal notranslate"><span class="pre">http_proxy</span></code> variables, it may be desirable to only download data
from inside your network.</p>
<p>To do this, you can set a variable in ilo.conf for the cli:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">firmware</span><span class="p">]</span>
<span class="n">mirror</span> <span class="o">=</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">buildserver</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">ilo</span><span class="o">-</span><span class="n">firmware</span><span class="o">/</span>
</pre></div>
</div>
<p>Or if you use the API, configure the firmware downloader, both the downloader
and the updater will then use your mirror:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">hpilo</span><span class="o">,</span> <span class="nn">hpilo_fw</span>
<span class="n">hpilo_fw</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">mirror</span><span class="o">=</span><span class="s1">&#39;http://buildserver.example.com/ilo-firmware/&#39;</span><span class="p">)</span>

<span class="n">ilo</span> <span class="o">=</span> <span class="n">hpilo</span><span class="o">.</span><span class="n">Ilo</span><span class="p">(</span><span class="n">hostname</span><span class="p">,</span> <span class="n">login</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
<span class="n">ilo</span><span class="o">.</span><span class="n">update_rib_firmware</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="s1">&#39;latest&#39;</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">print_progress</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="n">hpilo_fw</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;ilo4&#39;</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">print_progress</span><span class="p">)</span>
</pre></div>
</div>
<p>Your mirror should contain both <code class="file docutils literal notranslate"><span class="pre">firmware.conf</span></code>, and the <code class="xref py py-data docutils literal notranslate"><span class="pre">bin</span></code>
files for all firmware versions you want to support. You can create (and
auto-update via cron) such a mirror with a simple shellscript:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>

<span class="n">cd</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">ilo</span><span class="o">-</span><span class="n">firmware</span>
<span class="n">wget</span> <span class="o">-</span><span class="n">q</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">seveas</span><span class="o">.</span><span class="n">github</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">python</span><span class="o">-</span><span class="n">hpilo</span><span class="o">/</span><span class="n">firmware</span><span class="o">.</span><span class="n">conf</span>
<span class="n">hpilo_cli</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="n">download_rib_firmware</span> <span class="nb">all</span> <span class="nb">all</span>
</pre></div>
</div>
<p>This will download and extract the necessary files to
<code class="file docutils literal notranslate"><span class="pre">/var/www/html/ilo-firmware</span></code>.</p>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="snmp.html" class="btn btn-neutral float-left" title="SNMP settings" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="xmldata.html" class="btn btn-neutral float-right" title="Unauthenticated iLO and Chassis OA data" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2011-2020, Dennis Kaarsemaker.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>